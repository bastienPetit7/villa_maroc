{% extends 'base.html.twig' %}

{% block title %}Hello ShowPropertyController!{% endblock %}

{% block body %}


{% include "shared/_navbar.html.twig" %}



    <section>
      <!-- Slider main container-->
        <div class="swiper-container detail-slider slider-gallery">
            <!-- Additional required wrapper-->
            <div class="swiper-wrapper">
                <!-- Slides-->
                    <div class="swiper-slide"><a href="{{asset(property.mainPicture)}}" data-toggle="gallery-top" title="Photo Principal"><img class="img-fluid" src="{{asset(property.mainPicture)}}" alt=""></a></div>
                {% for image in property.images %}
                    
                    <div class="swiper-slide"><a href="{{asset(image.title)}}" data-toggle="gallery-top" title="Outside"><img class="img-fluid" src="{{asset(image.title)}}" alt=""></a></div>
                {% endfor %}
            </div>
            <div class="swiper-pagination swiper-pagination-white"></div>
            <div class="swiper-button-prev swiper-button-white"></div>
            <div class="swiper-button-next swiper-button-white"></div>
        </div>
    </section>
    <div class="container py-5">
      <div class="row">
        <div class="col-lg-8"> 
          <div class="text-block">
            <p class="text-primary"><i class="fa-map-marker-alt fa me-1"></i> Marrakech, Maroc</p>
            <h1>{{property.title}}</h1>
            <p class="text-muted  mb-4">{% if property.type == 0 %}Villa {% else %} Appartement {% endif %} entière </p>
            <ul class="list-inline text-sm mb-4">
              <li class="list-inline-item me-3"><i class="fa fa-users me-1 text-secondary"></i> {{property.guests}} guests</li>
              <li class="list-inline-item me-3"><i class="fa fa-door-open me-1 text-secondary"></i> {{property.bedrooms}} bedroom</li>
              <li class="list-inline-item me-3"><i class="fa fa-bed me-1 text-secondary"></i> {{property.bedrooms}} beds</li>
              <li class="list-inline-item me-3"><i class="fa fa-bath me-1 text-secondary"></i> {{property.bathrooms}} bath</li>
            </ul>
            <p class="text-muted fw-light"> {{property.description | raw}} </p>
            </div>
          <div class="text-block">
            <h4 class="mb-4">Amenities</h4>
            <div class="row"> 
              <div class="col-md-6">
                <ul class="list-unstyled text-muted">
                  <li class="mb-2"> <i class="fa fa-wifi text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Wifi</span></li>
                  <li class="mb-2"> <i class="fa fa-tv text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Cable TV</span></li>
                  <li class="mb-2"> <i class="fa fa-snowflake text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Air conditioning</span></li>
                  <li class="mb-2"> <i class="fa fa-thermometer-three-quarters text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Heating</span></li>
                </ul>
              </div>
              <div class="col-md-6">
                <ul class="list-unstyled text-muted">
                  <li class="mb-2"> <i class="fa fa-bath text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Toiletteries</span></li>
                  <li class="mb-2"> <i class="fa fa-utensils text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Equipped Kitchen</span></li>
                  <li class="mb-2"> <i class="fa fa-laptop text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Desk for work</span></li>
                  <li class="mb-2"> <i class="fa fa-tshirt text-secondary w-1rem me-3 text-center"></i><span class="text-sm">Washing machine</span></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="text-block">
            <h4 class="mb-0">Amenities alternative</h4>
            <p class="subtitle text-sm text-primary mb-4">Alternative amenities display</p>
            <ul class="list-inline">
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Wifi</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Cable TV</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Air conditioning</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Heating</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Toiletteries</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Equipped Kitchen</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Desk for work</span></li>
              <li class="list-inline-item mb-2"><span class="badge rounded-pill bg-light p-3 text-muted fw-normal">Washing machine</span></li>
            </ul>
          </div>
          <div class="text-block">
            <div class="d-flex"><img class="avatar avatar-lg p-1 flex-shrink-0 me-4" src="{{asset('uploads/ja_profile.jpeg')}}" alt="Jack London">
              <div>
              
                <p> <span class="text-muted text-uppercase text-sm">Hosted by </span><br><strong>J-A</strong></p>
                <p class="text-muted text-sm mb-2">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.</p>
                <p class="text-muted text-sm">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
              </div>
            </div>
          </div>
          <div class="text-block">
            <h5 class="mb-4">Listing location</h5>
            <div class="map-wrapper-300 mb-3">
              <div class="h-100" id="detailMap"></div>
            </div>
          </div>
          <div class="text-block">
            <h5 class="mb-4">Gallery</h5>
            <div class="row gallery mb-3 ms-n1 me-n1">
                    <div class="col-lg-4 col-6 px-1 mb-2"><a href="{{asset(property.mainPicture)}}" data-fancybox="gallery" title="Our street"><img class="img-fluid" src="{{asset(property.mainPicture)}}" alt="..."></a></div>
                {% for image in property.images %}
                    <div class="col-lg-4 col-6 px-1 mb-2"><a href="{{asset(image.title)}}" data-fancybox="gallery" title="Our street"><img class="img-fluid" src="{{asset(image.title)}}" alt="..."></a></div>
                    
                {% endfor %}
              
            </div>
          </div>
          <div class="text-block">
            <p class="subtitle text-sm text-primary">Reviews    </p>
            <h5 class="mb-4">Listing Reviews </h5>
            <div class="d-flex d-block d-sm-flex review">
              <div class="text-md-center flex-shrink-0 me-4 me-xl-5"><img class="d-block avatar avatar-xl p-2 mb-2" src="{{asset('img/avatar/avatar-8.jpg')}}" alt="Padmé Amidala"><span class="text-uppercase text-muted text-sm">Dec 2018</span></div>
              <div>
                <h6 class="mt-2 mb-1">Padmé Amidala</h6>
                <div class="mb-2"><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i>
                </div>
                <p class="text-muted text-sm">One morning, when Gregor Samsa woke from troubled dreams, he found himself transformed in his bed into a horrible vermin. He lay on his armour-like back, and if he lifted his head a little he could see his brown belly, slightly domed and divided by arches into stiff sections     </p>
              </div>
            </div>
            <div class="d-flex d-block d-sm-flex review">
              <div class="text-md-center flex-shrink-0 me-4 me-xl-5"><img class="d-block avatar avatar-xl p-2 mb-2" src="{{asset('img/avatar/avatar-2.jpg')}}" alt="Luke Skywalker"><span class="text-uppercase text-muted text-sm">Dec 2018</span></div>
              <div>
                <h6 class="mt-2 mb-1">Luke Skywalker</h6>
                <div class="mb-2"><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-gray-200"></i>
                </div>
                <p class="text-muted text-sm">The bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. &quot;What's happened to me?&quot; he thought. It wasn't a dream.     </p>
              </div>
            </div>
            <div class="d-flex d-block d-sm-flex review">
              <div class="text-md-center flex-shrink-0 me-4 me-xl-5"><img class="d-block avatar avatar-xl p-2 mb-2" src="{{asset('img/avatar/avatar-3.jpg')}}" alt="Princess Leia"><span class="text-uppercase text-muted text-sm">Dec 2018</span></div>
              <div>
                <h6 class="mt-2 mb-1">Princess Leia</h6>
                <div class="mb-2"><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-gray-200"></i><i class="fa fa-xs fa-star text-gray-200"></i>
                </div>
                <p class="text-muted text-sm">His room, a proper human room although a little too small, lay peacefully between its four familiar walls. A collection of textile samples lay spread out on the table.     </p>
              </div>
            </div>
            <div class="d-flex d-block d-sm-flex review">
              <div class="text-md-center flex-shrink-0 me-4 me-xl-5"><img class="d-block avatar avatar-xl p-2 mb-2" src="{{asset('img/avatar/avatar-4.jpg')}}" alt="Jabba Hut"><span class="text-uppercase text-muted text-sm">Dec 2018</span></div>
              <div>
                <h6 class="mt-2 mb-1">Jabba Hut</h6>
                <div class="mb-2"><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i><i class="fa fa-xs fa-star text-primary"></i>
                </div>
                <p class="text-muted text-sm">Samsa was a travelling salesman - and above it there hung a picture that he had recently cut out of an illustrated magazine and housed in a nice, gilded frame.     </p>
              </div>
            </div>
            <div class="py-5">
              <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#leaveReview" aria-expanded="false" aria-controls="leaveReview">Leave a review</button>
              <div class="collapse mt-4" id="leaveReview">
                <h5 class="mb-4">Leave a review</h5>
                <form class="form" id="contact-form" method="get" action="#">
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="mb-4">
                        <label class="form-label" for="name">Your name *</label>
                        <input class="form-control" type="text" name="name" id="name" placeholder="Enter your name" required="required">
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="mb-4">
                        <label class="form-label" for="rating">Your rating *</label>
                        <select class="form-select focus-shadow-0" name="rating" id="rating">
                          <option value="5">&#9733;&#9733;&#9733;&#9733;&#9733; (5/5)</option>
                          <option value="4">&#9733;&#9733;&#9733;&#9733;&#9734; (4/5)</option>
                          <option value="3">&#9733;&#9733;&#9733;&#9734;&#9734; (3/5)</option>
                          <option value="2">&#9733;&#9733;&#9734;&#9734;&#9734; (2/5)</option>
                          <option value="1">&#9733;&#9734;&#9734;&#9734;&#9734; (1/5)</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="mb-4">
                    <label class="form-label" for="email">Your email *</label>
                    <input class="form-control" type="email" name="email" id="email" placeholder="Enter your  email" required="required">
                  </div>
                  <div class="mb-4">
                    <label class="form-label" for="review">Review text *</label>
                    <textarea class="form-control" rows="4" name="review" id="review" placeholder="Enter your review" required="required"></textarea>
                  </div>
                  <button class="btn btn-primary" type="submit">Post review</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="p-4 shadow ms-lg-4 rounded sticky-top" style="top: 100px;">
            <p class="text-muted"><span class="text-primary h2">{{property.price | amount}}</span> per week</p>
            <hr class="my-4">


            <form class="form" id="booking-form" method="get" action="{{path('')}} " autocomplete="off">
              <div class="mb-4">
                <label class="form-label" for="bookingDate">Your stay *</label>
                <div class="datepicker-container datepicker-container-right">
                  <input class="form-control" type="text" name="bookingDate" id="bookingDate" placeholder="Choose your dates" required="required">
                </div>
              </div>
              <div class="mb-4">
                <label class="form-label" for="guests">Guests *</label>
                <select class="form-control" name="guests" id="guests">
                  <option value="1">1 Guest</option>
                  <option value="2">2 Guests</option>
                  <option value="3">3 Guests</option>
                  <option value="4">4 Guests</option>
                  <option value="5">5 Guests</option>
                  <option value="6">6 Guests</option>
                  <option value="7">7 Guests</option>
                  <option value="8">8 Guests</option>
                  
                </select>
              </div>
              <div class="d-grid mb-4">
                <button class="btn btn-primary" type="submit">Réserver</button>
              </div>
            </form>


            <p class="text-muted text-sm text-center">Some additional text can be also placed here.</p>
            <hr class="my-4">
            <div class="text-center">
              <p> <a class="text-secondary text-sm" href="#"> <i class="fa fa-heart"></i> Bookmark This Listing</a></p>
              <p class="text-muted text-sm">79 people bookmarked this place </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-6 bg-gray-100"> 
      <div class="container">
        <h5 class="mb-0">Similar places</h5>
        <p class="subtitle text-sm text-primary mb-4">You may also like         </p>
        <!-- Slider main container-->
        <div class="swiper-container swiper-container-mx-negative swiper-init pt-3" data-swiper="{&quot;slidesPerView&quot;:4,&quot;spaceBetween&quot;:20,&quot;loop&quot;:false,&quot;roundLengths&quot;:true,&quot;breakpoints&quot;:{&quot;1200&quot;:{&quot;slidesPerView&quot;:3},&quot;991&quot;:{&quot;slidesPerView&quot;:2},&quot;565&quot;:{&quot;slidesPerView&quot;:1}},&quot;pagination&quot;:{&quot;el&quot;:&quot;.swiper-pagination&quot;,&quot;clickable&quot;:true,&quot;dynamicBullets&quot;:true}}">
          <!-- Additional required wrapper-->
          <div class="swiper-wrapper pb-5">
            <!-- Slides-->
            

                {% for propriete in properties %}
                    {% if propriete.id != property.id %}
                    <div class="swiper-slide h-auto px-2">
                                <!-- place item-->
                        <div class="w-100 h-100 hover-animate" data-marker-id="59c0c8e33b1527bfe2abaf92">
                            <div class="card h-100 border-0 shadow">
                                <div class="card-img-top overflow-hidden gradient-overlay"> <img class="img-fluid" src="{{asset(propriete.mainPicture)}}" style="object-fit:cover; height:200px;" alt="Modern, Well-Appointed Room"/><a class="tile-link" href="detail-rooms.html"></a>
                                    
                                </div>
                                <div class="card-body d-flex align-items-center">
                                    <div class="w-100">
                                        <h6 class="card-title"><a class="text-decoration-none text-dark" href="detail-rooms.html"> {{propriete.title}}</a></h6>
                                        <div class="d-flex card-subtitle mb-3">
                                            <p class="flex-grow-1 mb-0 text-muted text-sm">Private room</p>
                                            <p class="flex-shrink-1 mb-0 card-stars text-xs text-end"><i class="fa fa-star text-warning"></i><i class="fa fa-star text-warning"></i><i class="fa fa-star text-warning"></i><i class="fa fa-star text-warning"></i><i class="fa fa-star text-warning"></i>
                                            </p>
                                        </div>
                                        <p class="card-text text-muted"><span class="h4 text-primary">$80</span> per night</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    {% endif %}
                    
                {% endfor %}
              
            </div>
            
          </div>
          <!-- If we need pagination-->
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </div>

    {% for booking in bookings %}
        
            
         
        <input type="hidden" id="resaStart{{loop.index}}" value="{{booking.start | date('Y-m-d')}}">
        <input type="hidden" id="resaEnd{{loop.index}}" value="{{booking.end | date('Y-m-d')}}">


        
    {% endfor %}
    
    


{% include "shared/_footer.html.twig" %}

    


<!-- jQuery-->
        <script src="{{asset('front_theme/vendor/jquery/jquery.min.js')}}"></script>
           <!-- Map-->
        <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
        <!-- Available tile layers-->
        <script src="{{asset('front_theme/js/map-layers.js')}}"> </script>
        <script src="{{asset('front_theme/js/map-detail.js')}}"></script>
          <script>
          createDetailMap({
              mapId: 'detailMap',
              mapZoom: 12,
              mapCenter: [{{property.latitude}}, {{property.longitude}}],
              circleShow: true,
              circlePosition: [{{property.latitude}}, {{property.longitude}}]
          })
          
        </script>
           <!-- Daterange picker-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"> </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-date-range-picker/0.19.0/jquery.daterangepicker.min.js"> </script>
        <script src="{{asset('front_theme/js/datepicker-category.js')}}"> </script>
      
        <script>
        //   "use strict";

            function getDaysArray(start, end) {
                for(var arr=[],dt=new Date(start); dt<=end; dt.setDate(dt.getDate()+1)){
                    arr.push(new Date(dt));
                }
                return arr;
            };


            // console.log(daylist.toISOString().split("T")[0]);
            function getDataDaysArray(){
                let arrResult = [];
                let resas = [];
                for (let i = 1; i <= {{bookings | length}}; i++) {
                
                let inputResaStart = document.getElementById(`resaStart${i}`)
                let inputResaEnd = document.getElementById(`resaEnd${i}`)

                let toStringResaStart = JSON.stringify(inputResaStart.value)
                let toStringResaEnd = JSON.stringify(inputResaEnd.value)
                
                
                console.log(toStringResaStart, toStringResaEnd );
                var daylist = getDaysArray(new Date(toStringResaStart),new Date(toStringResaEnd));
                daylist.forEach((day) => {
                    arrResult.push(day.toLocaleString().replace(', 00:00:00', '').replace('/', '-').replace('/', '-'))
                })
            
                }
                
                
                console.log(arrResult);
                return arrResult;
                
            }


             var unavailableDate = getDataDaysArray();  

            $(function () {
                var singleMonth = false;
                if ($(window).width() < 767) {
                    singleMonth = true;
                }

                var dateRangeConfig = {
                    autoClose: true,
                    startDate: new Date(),
                    selectForward: true,
                    applyBtnClass: "btn btn-primary",
                    container: ".datepicker-container",
                    inline: true,
                    singleMonth: singleMonth,
                    showDateFilter: function (time, date) {
                        return (
                            '<div style="padding:0 5px;">\
                                        <span style="font-weight:bold">' +
                            date + '</div>'
                        );
                    },
                    beforeShowDay: function (t) {
                        let jour = t.getDate(); 
                        if(t.getDate() < 10){
                            jour =  `0${jour}`
                        }
                        let dmy = jour +"-"+ (t.getMonth() + 1) +"-"+ t.getFullYear()
                    if($. inArray(dmy, unavailableDate) == -1){
                        console.log('ciao');
                        return [true, ""]
                    }else {
                        console.log('hello');
                        return [false, "", "Booked"]
                    }
                    },
                    customOpenAnimation: function (cb) {
                        $(this).fadeIn(300, cb);
                    },
                    customCloseAnimation: function (cb) {
                        $(this).fadeOut(300, cb);
                    },
                };

                
                $("#bookingDate")
                    .dateRangePicker(dateRangeConfig)
                    .bind("datepicker-opened", function () {
                        /* This event will be triggered after date range picker open animation */
                        //$('.date-picker-wrapper').css('top', 0);
                    });
            });

        </script>


{% endblock %}
